#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "util/list.h"
char readByteR(const char* pBuf,long* pos) {
	return pBuf[(*pos)--];
}
int readVIntR(const char* pBuf,long* pos) {
	/* This is the original code of this method,
	 * but a Hotspot bug (see LUCENE-2975) corrupts the for-loop if
	 * readByte() is inlined. So the loop was unwinded!
	 char b = readByte();
	 int i = b & 0x7F;
	 for (int shift = 7; (b & 0x80) != 0; shift += 7) {
	 b = readByte();
	 i |= (b & 0x7F) << shift;
	 }
	 return i;
	 */
	char b = readByteR(pBuf, pos);
	if (b >= 0) return b;
	int i = b & 0x7F;
	b = readByteR(pBuf, pos);
	i |= (b & 0x7F) << 7;
	//if (b >= 0) return htonl(i);
	if (b >= 0) return i;
	b = readByteR(pBuf, pos);
	i |= (b & 0x7F) << 14;
	if (b >= 0) return i;
	b = readByteR(pBuf, pos);
	i |= (b & 0x7F) << 21;
	if (b >= 0) return i;
	b = readByteR(pBuf, pos);
	// Warning: the next ands use 0x0F / 0xF0 - beware copy/paste errors:
	i |= (b & 0x0F) << 28;
	if ((b & 0xF0) == 0) return i;
}

int readVIntRP(const char* pBuf, long* pos, const char* szName) {
	uint32_t i = readVIntR(pBuf, pos);
	printf("%s = %u\n", szName, i);
	return i;
}

uint64_t readVLongR(const char* pBuf,long* pos) {
    /* This is the original code of this method,
     * but a Hotspot bug (see LUCENE-2975) corrupts the for-loop if
     * readByte() is inlined. So the loop was unwinded!
    byte b = readByte();
    long i = b & 0x7F;
    for (int shift = 7; (b & 0x80) != 0; shift += 7) {
      b = readByte();
      i |= (b & 0x7FL) << shift;
    }
    return i;
    */
    char b = readByteR(pBuf, pos);
    if (b >= 0) return b;
    long i = b & 0x7FL;
    b = readByteR(pBuf, pos);
    i |= (b & 0x7FL) << 7;
    if (b >= 0) return i;
    b = readByteR(pBuf, pos);
    i |= (b & 0x7FL) << 14;
    if (b >= 0) return i;
    b = readByteR(pBuf, pos);
    i |= (b & 0x7FL) << 21;
    if (b >= 0) return i;
    b = readByteR(pBuf, pos);
    i |= (b & 0x7FL) << 28;
    if (b >= 0) return i;
    b = readByteR(pBuf, pos);
    i |= (b & 0x7FL) << 35;
    if (b >= 0) return i;
    b = readByteR(pBuf, pos);
    i |= (b & 0x7FL) << 42;
    if (b >= 0) return i;
    b = readByteR(pBuf, pos);
    i |= (b & 0x7FL) << 49;
    if (b >= 0) return i;
    b = readByteR(pBuf, pos);
    i |= (b & 0x7FL) << 56;
    if (b >= 0) return i;
}
uint64_t readVLongRP(const char* pBuf, long* pos, const char* szName) {
	uint64_t i = readVLongR(pBuf, pos);
	printf("%s = %llu\n", szName, i);
	return i;
}
char readByteRP(const char* pBuf, long* pos, const char* szName) {
	char b = readByteR(pBuf, pos);
	printf("%s = %d\n", szName, b);
	return b;
}

void readBytesR(unsigned char* dst, int offset, int len,const char* src, long* pos) {
	for(int i=0;i<len;i++) {
		dst[offset+i] = src[(*pos)--];
		printf("%02x",dst[offset+i]);
	}
	printf("\n");
}
char* readR(const char* pBuf, long* pos) {
	int len = readVIntR(pBuf,pos);
	char* output = (char*)malloc(len);
	readBytesR((unsigned char*)output,0,len,pBuf,pos);
	return output;
}

char* readRP(const char* pBuf, long* pos, const char* szName) {
	printf(szName);
	printf(":");
	char* ret = readR(pBuf,pos);
	return ret;
}
static const int BIT_FINAL_ARC = 1 << 0;
static const int BIT_LAST_ARC = 1 << 1;
static const int BIT_TARGET_NEXT = 1 << 2;
static const int BIT_STOP_NODE = 1 << 3;
static const int BIT_ARC_HAS_OUTPUT = 1 << 4;
static const int BIT_ARC_HAS_FINAL_OUTPUT = 1 << 5;
static const int BIT_TARGET_DELTA = 1 << 6;

static const long FINAL_END_NODE = -1;
static const long NON_FINAL_END_NODE = 0;
struct Arc {
 long node;//节点当前在文件中的位置
 int numArcs;//一共有多少条弧线
 int bytesPerArc;//固定长度，以便随机访问节点
 int arcIdx;//表示当前的arc在整个数组中的位置
 long nextArc;//下一个节点的位置。
 long posArcsStart;//第一个节点的位置
 int flags;
 char label;
 char* nextFinalOutput;
 char* output;
 long target;
};

Arc readNextRealArc(Arc& arc, const char* szFst) {
	arc.arcIdx++;
	long pos = arc.posArcsStart;
	pos -= arc.arcIdx*arc.bytesPerArc;
	arc.flags = readByteRP(szFst,&pos,"flags");
	arc.label = readByteR(szFst,&pos);
	printf("label:%d(%c)\n",arc.label,arc.label);

	// output
	if (arc.flags & BIT_ARC_HAS_OUTPUT) {
		arc.output = readRP(szFst, &pos, "output");
	} else {
		arc.output = NULL;
	}

	//final output
	if (arc.flags & BIT_ARC_HAS_FINAL_OUTPUT) {
		arc.nextFinalOutput = readRP(szFst, &pos, "nextFinalOutput");
	} else {
		arc.nextFinalOutput = NULL;
	}

	// stop node
	if (arc.flags & BIT_STOP_NODE) {
      if (arc.flags & BIT_FINAL_ARC) {
        arc.target = FINAL_END_NODE;
      } else {
        arc.target = NON_FINAL_END_NODE;
      }

      arc.nextArc = pos;
    } else if (arc.flags & BIT_TARGET_NEXT) {
      arc.nextArc = pos;
      // TODO: would be nice to make this lazy -- maybe
      // caller doesn't need the target and is scanning arcs...
      //if (nodeAddress == NULL) {
      if (NULL) {
        if (!(arc.flags & BIT_LAST_ARC)) {
          if (arc.bytesPerArc == 0) {
            // must scan
     //       seekToNextNode(in);
          } else {
            pos = arc.posArcsStart;
            pos += arc.bytesPerArc * arc.numArcs;
          }
        }
        arc.target = pos;
      } else {
        arc.target = arc.node - 1;
      }
    } else {
	  bool packed = false;
      if (packed) {
		/*
        final long code = in.readVLong();
        if (arc.flag(BIT_TARGET_DELTA)) {
          // Address is delta-coded from current address:
          arc.target = pos + code;
        } else if (code < nodeRefToAddress.size()) {
          // Deref
          arc.target = nodeRefToAddress.get((int) code);
        } else {
          arc.target = code;
        }
		*/
      } else {
        arc.target = readVLongRP(szFst,&pos,"target");
      }
      arc.nextArc = pos;
    }
    return arc;
}
int main() {
	char szFst[] = {0x00,0x0C,0xC6,0x02,0x63,0x1F,0x70,0x0F,0x74,0x0F,0x00,0x00,0x00,0x09,0x7C,0xE2,0x02,0x74,0x12,0x00,0x00,0x00,0x00,0x6E,0xAA,0x02,0x73,0x19,0x00,0x00,0x00,0x00,0x61,0xCA,0x02,0x72,0x19,0x00,0x00,0x00,0x07,0x56,0xCA,0x02,0x70,0x10,0x74,0x12,0x6E,0xAA,0x45,0xAE,0x02,0x6E,0x19,0x02,0x72,0x19,0x07,0x39,0x8E,0x02,0x6C,0x19,0x05,0xFB,0x6F,0x01,0x23,0xBF,0x06,0x64,0x19,0x19,0x05,0xFB,0x05,0x18,0x8E,0x02,0x63,0x21,0x19,0x05,0x18,0x8E,0x03,0xDE,0x02,0x62,0x19,0x09,0x09,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x92,0xA2,0x03,0x75,0x1B,0x00,0x00,0x00,0x05,0xD7,0x6F,0x01,0x02,0x80,0x93,0x07,0x72,0x19,0x02,0x92,0xA2,0x04,0x81,0x6F,0x01,0x01,0xEF,0xA3,0x07,0x6F,0x19,0x07,0x72,0x19,0x04,0x81,0x6F,0x01,0x01,0xE6,0xE2,0x03,0x69,0x19,0x09,0xAB,0x6E,0x04,0xD3,0x68,0x02,0x01,0xC9,0x97,0x0A,0x65,0x19,0x01,0xC9,0x97,0x04,0xAD,0x72,0x01,0x01,0xB5,0xC7,0x07,0x61,0x19,0x0D,0x06,0x20,0x02,0xCE,0x92,0x03,0x61,0x1F,0x03,0x82,0xB6,0x03,0x70,0x1F,0x02,0xF8,0xBA,0x03,0x6D,0x1D,0x03,0xA0,0x92,0x03,0x74,0x1F,0x03,0x93,0xE2,0x03,0x73,0x1D,0x07,0xF9,0x67,0x01,0x03,0xAB,0xDB,0x07,0x6E,0x27,0x01,0xC0,0x6D,0x00,0x00,0x00,0x00,0x00,0x00,0x05,0xA1,0x69,0x01,0x03,0xE6,0xEF,0x07,0x72,0x1B,0x01,0xDA,0x0B,0xBD,0x73,0x05,0xAB,0x6D,0x02,0x03,0xC6,0x97,0x0A,0x6F,0x21,0x00,0x00,0x00,0x00,0x00,0x05,0xA1,0x69,0x01,0x02,0xEB,0xF6,0x03,0x6C,0x19,0x01,0xDA,0x0B,0xBD,0x73,0x05,0xAB,0x01,0xB4,0x02,0xDC,0x82,0x03,0x68,0x21,0x02,0xEB,0xF6,0x03,0x6C,0x19,0x01,0xB4,0x02,0x02,0xC5,0xBE,0x03,0x65,0x19,0xC5,0xBE,0x0A,0xC7,0x73,0x04,0x8B,0x6E,0x02,0x02,0xAA,0x97,0x0A,0x61,0x19,0x0F,0x06,0x20,0x04,0x8D,0x8E,0x03,0x73,0x1F,0x07,0xC7,0x65,0x01,0x04,0xCC,0xFF,0x07,0x73,0x1F,0x05,0x8D,0x8E,0x03,0x72,0x1F,0x04,0xB5,0x6E,0x01,0x04,0xFC,0xEF,0x07,0x6F,0x1D,0x02,0xC7,0x04,0xD5,0x67,0x01,0x04,0xE8,0xB3,0x07,0x69,0x21,0x02,0xBD,0x11,0xDD,0x70,0x0B,0xD3,0x67,0x06,0xB3,0x64,0x03,0x04,0x98,0x83,0x0D,0x65,0x21,0x05,0xD1,0xF6,0x03,0x70,0x1F,0x05,0x9F,0x65,0x01,0x05,0xDE,0xB3,0x07,0x78,0x27,0x05,0xC7,0xCA,0x03,0x76,0x19,0x05,0x85,0x65,0x01,0x05,0xB0,0xCB,0x07,0x6E,0x19,0x05,0xA4,0xC2,0x03,0x6D,0x19,0x06,0xD8,0xBA,0x03,0x72,0x1F,0x00,0x00,0x00,0x00,0x06,0xF7,0xB6,0x03,0x72,0x1B,0x00,0x00,0x03,0xA1,0x06,0xE8,0xAA,0x03,0x6F,0x21,0xA1,0x06,0xE8,0xAA,0x06,0xCD,0xE2,0x03,0x6C,0x19,0x04,0x9F,0x6E,0x01,0x06,0xBA,0xEB,0x07,0x69,0x19,0x04,0x89,0x6C,0x01,0x06,0xA5,0xC3,0x07,0x61,0x19,0x0A,0x05,0x20,0x06,0xE3,0x69,0x01,0x07,0xB1,0xC7,0x07,0x72,0x1F,0x07,0xA8,0xFE,0x03,0x6F,0x1D,0x07,0xA0,0x8E,0x03,0x65,0x1D,0x07,0x97,0x86,0x03,0x61,0x1D,0x07,0xD8,0xB2,0x03,0x72,0x1F,0x00,0x00,0x00,0x00,0x08,0xA1,0x8A,0x03,0x75,0x1B,0x03,0xFD,0x70,0x01,0x08,0x8F,0xBF,0x07,0x6F,0x19,0xFD,0x70,0x01,0x08,0x08,0x82,0xDE,0x03,0x69,0x19,0x04,0xA3,0x69,0x01,0x07,0xEF,0xEF,0x07,0x65,0x19,0xEF,0xEF,0x03,0xF8,0x07,0xE1,0xD2,0x03,0x61,0x21,0x0A,0x05,0x20,0x65,0x0F,0x08,0xC6,0xA2,0x03,0x74,0x16,0x08,0xB7,0xF2,0x03,0x73,0x19,0x12,0xA9,0x70,0x0D,0x89,0x67,0x05,0xB5,0x64,0x03,0x08,0xD3,0xF7,0x0D,0x6E,0x27,0x07,0x08,0xAB,0x9A,0x03,0x6D,0x10,0x09,0xDB,0xE2,0x03,0x61,0x1F,0x04,0xC7,0x72,0x01,0x0A,0x8D,0x93,0x07,0x6F,0x1F,0x08,0xAF,0x6F,0x04,0xA9,0x6B,0x02,0x09,0xF4,0xD3,0x0A,0x69,0x1D,0x04,0xD8,0x09,0xE5,0xB2,0x03,0x65,0x21,0x03,0xF3,0x70,0x01,0x09,0xCB,0x93,0x07,0x61,0x1D,0x05,0x87,0x6F,0x01,0x0A,0xFB,0xCB,0x07,0x6F,0x1F,0x04,0xD9,0x6E,0x01,0x0A,0xE4,0xAB,0x07,0x69,0x1D,0x04,0xBB,0x6D,0x01,0x0A,0xD0,0xAF,0x07,0x65,0x1D,0x10,0xB9,0x74,0x0A,0xDF,0x70,0x05,0xB5,0x6C,0x03,0x0A,0xA9,0x97,0x0D,0x61,0x1D,0x0B,0xBE,0xCE,0x03,0x6F,0x1F,0x04,0xB7,0x6C,0x01,0x0B,0xAD,0xD3,0x07,0x65,0x1D,0x0B,0xA2,0xAA,0x03,0x61,0x1D,0x0B,0xEA,0xA2,0x03,0x75,0x1F,0x0B,0xE0,0x9A,0x03,0x72,0x1D,0x0B,0xD6,0xBE,0x03,0x70,0x1D,0x0C,0xA3,0x8A,0x03,0x72,0x1F,0x0C,0xC0,0x86,0x03,0x72,0x1F,0x61,0x0F,0x0A,0xBD,0x6A,0x04,0xDD,0x64,0x02,0x0D,0xA5,0xDB,0x0A,0x6F,0x1F,0x0D,0x9B,0xEE,0x03,0x69,0x1D,0x04,0xEF,0x73,0x01,0x0D,0x89,0x9B,0x07,0x65,0x1D,0x00,0x00,0x00,0x00,0x00,0x00,0x0D,0xC7,0x9E,0x03,0x75,0x1B,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x06,0x82,0x72,0x00,0x00,0x00,0x04,0xBB,0x70,0x01,0x0C,0xF0,0xB3,0x07,0x6F,0x19,0x03,0x75,0x1B,0x06,0x05,0xE5,0x0C,0xE9,0x82,0x03,0x6C,0x10,0xF0,0xB3,0x07,0x6F,0x19,0x05,0x0C,0xDF,0x82,0x03,0x69,0x19,0x10,0x0C,0xDF,0x82,0x05,0xE3,0x0C,0xD2,0xB6,0x03,0x65,0x21,0x05,0xDD,0x05,0x9F,0x74,0x01,0x0C,0xAD,0xBF,0x07,0x61,0x21,0x0C,0x07,0x20,0x75,0x0F,0x05,0x87,0x70,0x01,0x0E,0x9F,0x93,0x07,0x73,0x1F,0x0E,0x95,0x8E,0x03,0x70,0x1D,0x0E,0x89,0xD2,0x03,0x61,0x1D,0x0E,0xFB,0xCA,0x03,0x6F,0x1F,0x0E,0xF1,0x96,0x03,0x69,0x1D,0x06,0xF1,0x16,0xAB,0x6E,0x0E,0xEB,0x6C,0x09,0xF7,0x67,0x05,0x8D,0x64,0x04,0x0E,0xB4,0x97,0x10,0x65,0x21,0x0D,0xFF,0x82,0x03,0x61,0x1D,0x0F,0xAE,0xA2,0x03,0x6C,0x1F,0x10,0xB7,0x9A,0x03,0x72,0x1F,0x04,0x81,0x72,0x01,0x10,0xA7,0x8B,0x07,0x61,0x1D,0x00,0x00,0x0D,0xA9,0x72,0x05,0xDB,0x64,0x02,0x10,0xD7,0xA7,0x0A,0x75,0x1B,0x00,0x00,0x00,0x07,0xAE,0x04,0x99,0x6F,0x01,0x10,0xC4,0xB7,0x07,0x74,0x21,0x00,0x00,0x00,0x00,0x00,0x04,0xC9,0x69,0x01,0x10,0x96,0xB7,0x07,0x70,0x19,0x05,0xDB,0x64,0x02,0x10,0x04,0xBD,0x6D,0x01,0x10,0x82,0xD3,0x07,0x6F,0x19,0x01,0x10,0xC4,0xB7,0x07,0x04,0xB9,0x6C,0x01,0x0F,0xEC,0xF3,0x07,0x69,0x19,0x70,0x19,0x04,0xBD,0x6D,0x04,0xD5,0x6F,0x01,0x0F,0xDA,0xDB,0x07,0x68,0x19,0x07,0x9E,0x0A,0xBF,0x6F,0x04,0x8D,0x64,0x02,0x0F,0xB9,0x8F,0x0A,0x65,0x21,0x68,0x19,0x07,0x9E,0x0A,0xBF,0x6F,0x04,0x8D,0x0F,0xA1,0xBE,0x03,0x63,0x19,0x65,0x21,0x0F,0xA1,0xBE,0x04,0xE1,0x72,0x01,0x0F,0x8F,0xB3,0x07,0x61,0x19,0x0F,0x09,0x20,0x11,0xC0,0xFA,0x03,0x65,0x1F,0x11,0xF8,0xBE,0x03,0x61,0x1F,0x00,0x00,0x00,0x00,0x00,0x08,0xC4,0x12,0x83,0xCE,0x03,0x72,0x23,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x11,0xEA,0xEE,0x03,0x6F,0x19,0x08,0xC4,0x12,0x83,0xCE,0x03,0x72,0x11,0xDE,0x92,0x03,0x69,0x19,0x19,0x08,0xBE,0x04,0xF7,0x6F,0x01,0x11,0xC9,0x93,0x07,0x68,0x21,0x0A,0x97,0x72,0x04,0xBF,0x6C,0x02,0x11,0xA6,0xDF,0x0A,0x65,0x19,0x11,0xA6,0xDF,0x04,0x95,0x6D,0x01,0x11,0x97,0xAB,0x07,0x61,0x19,0x0D,0x06,0x20,0x05,0xEB,0x66,0x01,0x12,0xA0,0xB3,0x07,0x6E,0x1F,0x12,0xC8,0xA2,0x03,0x69,0x1F,0x72,0x0F,0x00,0x00,0x09,0xA7,0x13,0xA7,0x8E,0x03,0x6F,0x12,0x00,0x00,0x00,0x00,0x13,0x99,0xCE,0x03,0x69,0x19,0xA7,0x8E,0x03,0x6F,0x13,0x90,0x8A,0x03,0x68,0x19,0x19,0x13,0x90,0x8A,0x13,0x81,0xB2,0x03,0x65,0x19,0x04,0xDD,0x72,0x01,0x12,0xED,0x93,0x07,0x61,0x19,0x0A,0x05,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x13,0xBD,0xD2,0x03,0x79,0x1B,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x09,0xDC,0x13,0xB0,0xAA,0x03,0x77,0x21,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x09,0xA5,0x07,0xF1,0x68,0x01,0x12,0xD7,0xF7,0x07,0x76,0x21,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x09,0x9F,0x12,0xBC,0xE2,0x03,0x75,0x21,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x09,0x95,0x12,0x90,0xFE,0x03,0x74,0x21,0x00,0x00,0x00,0x00,0x00,0x00,0x08,0xB8,0x09,0xBD,0x77,0x05,0xB3,0x6D,0x02,0x10,0xFA,0xD3,0x0A,0x73,0x21,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x98,0x0F,0x86,0x92,0x03,0x72,0x21,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x06,0xDB,0x0D,0xF2,0xF6,0x03,0x71,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x06,0xD9,0x0D,0x87,0x73,0x04,0xF7,0x69,0x02,0x0D,0xD2,0xC7,0x0A,0x70,0x21,0x00,0x00,0x00,0x05,0xD7,0x10,0xBF,0x6F,0x0A,0xDF,0x68,0x05,0x9D,0x63,0x03,0x0B,0xF3,0x9B,0x0D,0x6F,0x21,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x05,0xC5,0x0B,0xC9,0xD2,0x03,0x6E,0x21,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x05,0xAF,0x0B,0x93,0x9E,0x03,0x6D,0x21,0x79,0x1B,0x09,0xDC,0x13,0xB0,0xAA,0x03,0x77,0x21,0x09,0xA5,0x07,0x05,0x81,0x0A,0x9F,0xE2,0x03,0x6C,0x21,0x21,0x09,0x9F,0x12,0xBC,0xE2,0x03,0x75,0x21,0x09,0x95,0x04,0xF7,0x6C,0x01,0x09,0xBA,0x87,0x07,0x6B,0x19,0x77,0x05,0xB3,0x6D,0x02,0x10,0xFA,0xD3,0x0A,0x73,0x21,0x04,0xBF,0x69,0x01,0x09,0xA6,0x8B,0x07,0x6A,0x19,0x0D,0xF2,0xF6,0x03,0x71,0x10,0x04,0xD2,0x09,0xE1,0x70,0x04,0xD9,0x69,0x02,0x09,0x87,0xDB,0x0A,0x69,0x21,0x05,0xD7,0x10,0xBF,0x6F,0x0A,0xDF,0x68,0x05,0x9D,0x63,0x03,0x0B,0xF3,0x9B,0x0D,0x6F,0x04,0xAD,0x68,0x00,0xC9,0xD2,0x03,0x6E,0x21,0x05,0xAF,0x0B,0x93,0x03,0xF2,0x06,0x83,0x6F,0x01,0x07,0xC5,0xC7,0x07,0x67,0x21,0x04,0xF7,0x6C,0x01,0x09,0xBA,0x87,0x07,0x6B,0x03,0xD6,0x04,0xC3,0x69,0x01,0x07,0x84,0xFB,0x07,0x66,0x21,0x03,0x9B,0x16,0xBB,0x74,0x0F,0xCF,0x71,0x0A,0xF1,0x6C,0x06,0x89,0x65,0x04,0x05,0xF3,0xC3,0x10,0x65,0x21,0x83,0x6F,0x01,0x07,0xC5,0xC7,0x07,0x67,0x21,0x03,0xD6,0x04,0xC3,0x02,0xF5,0x05,0x96,0xF2,0x03,0x64,0x21,0x03,0x9B,0x16,0xBB,0x74,0x0F,0xCF,0x71,0x0A,0x02,0xB7,0x04,0x99,0x6C,0x01,0x03,0xF9,0xD7,0x07,0x63,0x21,0x02,0xF5,0x05,0x96,0xF2,0x03,0x64,0x21,0x02,0xB7,0x04,0x99,0x6C,0x01,0xAE,0x02,0x9F,0xC6,0x03,0x62,0x21,0xAE,0x02,0x9F,0xC6,0x5D,0x10,0xD5,0x75,0x0B,0xFB,0x6E,0x05,0xF3,0x68,0x03,0x01,0x86,0x9B,0x0D,0x61,0x21,0x15,0x18,0x20};
	char szFstEmpty[] = {0x13,0xC7,0x8A,0x03};
	char *p = szFstEmpty;
	int numBytes = sizeof(szFstEmpty);
	long pos = numBytes - 1;

	//  BytesReader reader;
	int len = readVIntRP(szFstEmpty,&pos,"len");
	unsigned char* output = (unsigned char*)malloc(len);
	printf("output:");
	readBytesR(output,0,len,szFstEmpty,&pos);

	//===========================
	printf("=======>>>\n");
	Arc arc ;
	memset(&arc,0,sizeof(arc));
	arc.arcIdx = -1;
	arc.flags = BIT_FINAL_ARC | BIT_LAST_ARC;
	//arc.nextFinalOutput = emptyOutput;

	numBytes = sizeof(szFst);
	pos = numBytes - 1;
	// getFirstArc
	int startNode = 1751;

	// readFirstRealTargetArc
	readByteRP(szFst,&pos,"ARCS_AS_FIXED_ARRAY(0x20)");
	arc.numArcs = readVIntRP(szFst,&pos, "numArcs");
	arc.bytesPerArc = readVIntRP(szFst,&pos, "bytesPerArc");
	arc.arcIdx = -1;
	arc.nextArc = pos;
	arc.posArcsStart = pos;
	printf("nextArc = %d\n",arc.nextArc);

	readNextRealArc(arc,szFst);
	printf("\n");

	List               list;
	ListElmt           *arcs;

	list_init(&list, free);
	arcs = list_head(&list);

	int count = 0;
	while(true) {
		if (arc.label < 0x80) {
			// 复制一份，并添加到列表中
			Arc *pArc = (Arc*)malloc(sizeof(Arc));
			*pArc = arc;

			list_ins_next(&list, NULL, pArc);
		} else {
			break;
		}
		if (arc.flags & BIT_LAST_ARC) {
			break;
		}
		readNextRealArc(arc,szFst);
		count++;
		printf("=====================\n");
	}
	printf("count= %d\n",count);


	return 0;
}
